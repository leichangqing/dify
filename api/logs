2024-08-06 07:40:20,972.972 WARNING [MainThread] [main.py:27] - Python-dotenv could not parse statement starting at line 215
2024-08-06 07:40:21,077.077 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://10.5.106.8:5001
2024-08-06 07:40:21,078.078 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 07:40:42,456.456 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 07:40:42,460.460 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 07:40:42,824.824 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 07:40:42,832.832 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 07:40:42,839.839 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 07:40:42,844.844 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:40:42,848.848 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:40:42] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:41:14,445.445 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:41:14] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 07:41:14,493.493 ERROR [Thread-15 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 07:41:14,520.520 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:41:14] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 07:44:24,061.061 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:24] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 07:44:24,064.064 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:24] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 07:44:24,076.076 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:24] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 07:44:24,079.079 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:24] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 07:44:24,089.089 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:24] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 07:44:25,716.716 INFO [Thread-23 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:25] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:44:25,720.720 INFO [Thread-22 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:25] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:44:34,065.065 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:34] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 07:44:40,571.571 INFO [Thread-25 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:44:40] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 07:45:36,023.023 INFO [Thread-27 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 07:45:36,028.028 INFO [Thread-28 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 07:45:36,037.037 INFO [Thread-26 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 07:45:36,042.042 INFO [Thread-29 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 07:45:36,056.056 INFO [Thread-30 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 07:45:36,069.069 INFO [Thread-31 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 07:45:36,720.720 INFO [Thread-33 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:45:36,725.725 INFO [Thread-32 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:45:36] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:54:03,570.570 WARNING [MainThread] [main.py:27] - Python-dotenv could not parse statement starting at line 215
2024-08-06 07:54:03,728.728 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://10.5.106.8:5001
2024-08-06 07:54:03,728.728 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 07:55:54,116.116 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://10.5.106.8:5001
2024-08-06 07:55:54,117.117 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 07:56:09,263.263 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 07:56:09,288.288 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 07:56:09,297.297 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 07:56:09,299.299 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:56:09,532.532 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 07:56:09,543.543 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 07:56:09,550.550 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:09] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 07:56:31,906.906 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:31] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 07:56:31,936.936 ERROR [Thread-15 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 07:56:31,940.940 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:31] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 07:56:43,263.263 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 07:56:43] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 08:11:10,063.063 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://10.5.106.8:5001
2024-08-06 08:11:10,064.064 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 08:12:36,566.566 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 08:12:36,571.571 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 08:12:36,617.617 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 08:12:36,870.870 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 08:12:36,892.892 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 08:12:36,912.912 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:12:36,919.919 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:12:36] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:14:41,860.860 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:14:41] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 08:15:03,866.866 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:15:03] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 08:19:40,099.099 ERROR [Thread-9 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 08:19:40,109.109 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:19:40] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 08:22:18,061.061 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 08:22:18,067.067 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 08:22:18,074.074 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 08:22:18,086.086 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 08:22:18,092.092 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 08:22:18,161.161 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:22:18,177.177 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:18] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:22:56,254.254 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:22:56] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 08:23:20,586.586 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:23:20] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 08:29:55,662.662 ERROR [Thread-20 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 08:49:43,668.668 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://10.5.106.8:5001
2024-08-06 08:49:43,673.673 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 08:49:55,089.089 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:55] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 08:49:55,092.092 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:55] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 08:49:55,131.131 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:55] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 08:49:55,315.315 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:55] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 08:49:55,342.342 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:55] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 08:49:55,362.362 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:55] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:49:56,100.100 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:56] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 08:49:56,110.110 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:56] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 08:49:56,127.127 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:56] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 08:49:56,133.133 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:56] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 08:49:58,763.763 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:49:58] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 08:50:08,236.236 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:50:08] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 08:50:10,377.377 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:50:10] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 201 -
2024-08-06 08:50:10,417.417 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:50:10] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:50:10,420.420 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:50:10] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:50:12,434.434 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:50:12] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 08:50:19,786.786 ERROR [Thread-16 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 08:50:19,797.797 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:50:19] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 08:52:05,404.404 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 08:52:05,409.409 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 08:52:05,414.414 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 08:52:05,424.424 INFO [Thread-22 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 08:52:05,431.431 INFO [Thread-23 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 08:52:05,454.454 INFO [Thread-25 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:52:05,471.471 INFO [Thread-24 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:05] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 08:52:38,164.164 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:38] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 08:52:45,569.569 INFO [Thread-27 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:52:45] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 08:55:18,681.681 ERROR [Thread-26 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 08:55:18,687.687 INFO [Thread-26 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 08:55:18] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 09:08:10,328.328 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://10.5.106.8:5001
2024-08-06 09:08:10,329.329 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 09:08:12,411.411 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 09:08:12,417.417 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 09:08:12,467.467 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 09:08:12,733.733 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 09:08:12,761.761 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 09:08:12,780.780 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 09:08:12,808.808 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:12] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 09:08:17,733.733 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:17] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 09:08:23,116.116 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:23] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 09:08:29,089.089 ERROR [Thread-9 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 09:08:29,106.106 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:08:29] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 09:09:45,161.161 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 09:09:45,167.167 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 09:09:45,173.173 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 09:09:45,180.180 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 09:09:45,199.199 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 09:09:45,235.235 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 09:09:45,239.239 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:45] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 09:09:50,557.557 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:50] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 09:09:56,216.216 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:09:56] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 09:12:56,355.355 ERROR [Thread-21 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 40, in post
    token = AccountService.login(account, ip_address=get_remote_ip(request))
  File "/Users/leicq/github/dify/api/services/account_service.py", line 220, in login
    token = AccountService.get_account_jwt_token(account, exp=exp)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 87, in get_account_jwt_token
    token = PassportService().issue(payload)
  File "/Users/leicq/github/dify/api/libs/passport.py", line 12, in issue
    return jwt.encode(payload, self.sk, algorithm='HS256')
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 67, in encode
    json_payload = self._encode_payload(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/jwt/api_jwt.py", line 94, in _encode_payload
    return json.dumps(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/frozendict/__init__.py", line 31, in default
    return BaseJsonEncoder.default(self, obj)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type UUID is not JSON serializable
2024-08-06 09:12:56,359.359 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 09:12:56] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 13:20:33,881.881 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 13:20:33,881.881 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 13:21:20,537.537 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:20] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:21:20,541.541 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:20] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:21:24,749.749 ERROR [Thread-1 (process_request_thread)] [app.py:838] - Exception on /console/api/apps [GET]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
MySQLdb.OperationalError: (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 72, in decorated
    elif not get_setup_status():
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 82, in get_setup_status
    return DifySetup.query.first()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2728, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2827, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3276, in connect
    return self._connection_cls(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
sqlalchemy.exc.OperationalError: (MySQLdb.OperationalError) (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-08-06 13:21:24,778.778 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:24] "[35m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 500 -
2024-08-06 13:21:24,782.782 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:24] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:21:27,194.194 ERROR [Thread-2 (process_request_thread)] [app.py:838] - Exception on /console/api/account/profile [GET]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
MySQLdb.OperationalError: (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 72, in decorated
    elif not get_setup_status():
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 82, in get_setup_status
    return DifySetup.query.first()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2728, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2827, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3276, in connect
    return self._connection_cls(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
sqlalchemy.exc.OperationalError: (MySQLdb.OperationalError) (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-08-06 13:21:27,199.199 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:27] "[35m[1mGET /console/api/account/profile HTTP/1.1[0m" 500 -
2024-08-06 13:21:28,873.873 ERROR [Thread-6 (process_request_thread)] [app.py:838] - Exception on /console/api/workspaces/current [GET]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
MySQLdb.OperationalError: (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 72, in decorated
    elif not get_setup_status():
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 82, in get_setup_status
    return DifySetup.query.first()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2728, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2827, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3276, in connect
    return self._connection_cls(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
sqlalchemy.exc.OperationalError: (MySQLdb.OperationalError) (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-08-06 13:21:28,877.877 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:28] "[35m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 500 -
2024-08-06 13:21:28,881.881 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:28] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:21:28,886.886 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:28] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:21:38,340.340 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:38] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 13:21:40,440.440 ERROR [Thread-9 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
MySQLdb.OperationalError: (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 72, in decorated
    elif not get_setup_status():
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 82, in get_setup_status
    return DifySetup.query.first()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2728, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2827, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3276, in connect
    return self._connection_cls(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3300, in raw_connection
    return self.pool.connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 620, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/__init__.py", line 121, in Connect
    return Connection(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/MySQLdb/connections.py", line 195, in __init__
    super().__init__(*args, **kwargs2)
sqlalchemy.exc.OperationalError: (MySQLdb.OperationalError) (2002, "Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-08-06 13:21:40,444.444 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:21:40] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 13:26:25,140.140 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 13:26:25,141.141 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 13:29:14,610.610 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:29:14] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 13:29:20,069.069 ERROR [Thread-1 (process_request_thread)] [app.py:838] - Exception on /console/api/login [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 75, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/auth/login.py", line 36, in post
    tenants = TenantService.get_join_tenants(account)
  File "/Users/leicq/github/dify/api/services/account_service.py", line 312, in get_join_tenants
    ).filter(TenantAccountJoin.account_id == account.id, Tenant.status == TenantStatus.NORMAL).all()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2673, in all
    return self._iter().all()  # type: ignore
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2827, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2236, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.encrypt_public_key AS tenants_encrypt_public_key, tenants.plan AS tenants_plan, tenants.status AS tenants_status, tenants.custom_config AS tenants_custom_config, tenants.created_at AS tenants_created_at, tenants.updated_at AS tenants_updated_at 
FROM tenants INNER JOIN tenant_account_joins ON tenants.id = tenant_account_joins.tenant_id 
WHERE tenant_account_joins.account_id = %s AND tenants.status = %s]
[parameters: [{}]]
2024-08-06 13:29:20,101.101 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:29:20] "[35m[1mPOST /console/api/login HTTP/1.1[0m" 500 -
2024-08-06 13:41:30,569.569 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 13:41:30,570.570 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 13:41:56,876.876 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:41:56] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:41:56,885.885 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:41:56] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:41:59,669.669 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:41:59] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 13:41:59,673.673 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:41:59] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:42:00,881.881 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:00] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 13:42:00,885.885 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:00] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:42:01,652.652 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:01] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:01,657.657 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:01] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:01,664.664 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:01] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 13:42:01,668.668 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:01] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 13:42:14,291.291 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:14] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:14,317.317 ERROR [Thread-11 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'MzA0NDIyYjU2Y2JiOTU4M2VlMDI1OTM5YmRmMWY3ZWU0OTZjOTBlMTU5YTBjYTA0NzQxM2YwMjQ4NmU0NmI0OA==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'MzA0NDIyYjU2Y2JiOTU4M2VlMDI1OTM5YmRmMWY3ZWU0OTZjOTBlMTU5YTBjYTA0NzQxM2YwMjQ4NmU0NmI0OA==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 13:42:14,356.356 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:14] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 13:42:30,555.555 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:30] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:30,576.576 ERROR [Thread-13 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'OGNmZWJiMzcwOTNjYjkyODFjNDdhNjQ4YWQwZWY5MTY5ODAyY2Y4ZmYzMmU0MmMwNTIwMjY4MjRjOWFlNzU0MA==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'OGNmZWJiMzcwOTNjYjkyODFjNDdhNjQ4YWQwZWY5MTY5ODAyY2Y4ZmYzMmU0MmMwNTIwMjY4MjRjOWFlNzU0MA==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 13:42:30,579.579 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:30] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 13:42:37,037.037 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:37] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:37,081.081 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:37] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:37,087.087 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:37] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 13:42:37,090.090 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:37] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 13:42:47,353.353 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:47] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:42:47,368.368 ERROR [Thread-19 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'ZmVmODI3NjA5YjUyYjU1ZTQyNjNkY2UzNmE2ODUxZWI4OTlhYTFkMWQzYzc0ZDYwOGIzODYzNjA2MjAyNzc0Zg==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'ZmVmODI3NjA5YjUyYjU1ZTQyNjNkY2UzNmE2ODUxZWI4OTlhYTFkMWQzYzc0ZDYwOGIzODYzNjA2MjAyNzc0Zg==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 13:42:47,370.370 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:47] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 13:42:49,081.081 ERROR [Thread-21 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'ODA5MWRjZjIzNGY5NzM2MDhiMWMzYmMyMzJiOWQ5ZDFkOWZkZDRlNjdkZTFiZTMyZTY0YWY5N2QxNGQ2YzI2NQ==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'password': 'ODA5MWRjZjIzNGY5NzM2MDhiMWMzYmMyMzJiOWQ5ZDFkOWZkZDRlNjdkZTFiZTMyZTY0YWY5N2QxNGQ2YzI2NQ==', 'email': 'changqinglei@wits.com', 'timezone': ... (77 characters truncated) ... theme': 'light', 'name': 'leicq', 'interface_language': 'en-US', 'last_login_at': None, 'avatar': None, 'initialized_at': None, 'last_login_ip': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 13:42:49,084.084 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:42:49] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 13:43:47,236.236 INFO [Thread-22 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:43:47] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:43:47,240.240 INFO [Thread-23 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:43:47] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:43:47,245.245 INFO [Thread-24 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:43:47] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:44:27,936.936 INFO [Thread-26 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:27] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 13:44:27,940.940 INFO [Thread-27 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:27] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 13:44:27,942.942 INFO [Thread-28 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:27] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:44:27,954.954 INFO [Thread-29 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:27] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:44:28,283.283 INFO [Thread-30 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:28] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:44:28,291.291 INFO [Thread-31 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:28] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:44:28,299.299 INFO [Thread-32 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:28] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 13:44:28,303.303 INFO [Thread-33 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:44:28] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 13:45:48,643.643 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 13:45:48,643.643 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 13:46:13,771.771 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:46:13] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:46:13,956.956 ERROR [Thread-2 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'password': 'Nzk5YmJhNDFmZDliNWEwZWJmYmRmYTIxOGYzNmZhMzY2MzBlMzkyYjcwYmNhMjM2NmEzODIxZWZlZjAyODgwZQ==', 'interface_la ... (77 characters truncated) ... XxDiwvKJg==', 'email': 'changqinglei@wits.com', 'name': 'leicq', 'avatar': None, 'last_login_at': None, 'initialized_at': None, 'last_login_ip': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'password': 'Nzk5YmJhNDFmZDliNWEwZWJmYmRmYTIxOGYzNmZhMzY2MzBlMzkyYjcwYmNhMjM2NmEzODIxZWZlZjAyODgwZQ==', 'interface_la ... (77 characters truncated) ... XxDiwvKJg==', 'email': 'changqinglei@wits.com', 'name': 'leicq', 'avatar': None, 'last_login_at': None, 'initialized_at': None, 'last_login_ip': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 13:46:14,007.007 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:46:14] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 13:46:16,238.238 ERROR [Thread-3 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'password': 'MGI2MTE0NTEyOWNlODQ2NmY0OWExZWZhMWM3YWEwY2M4YjE0MzBiZjc1YzE2ZGMzMGRiMjU3YjNhZjQ4YWYxZA==', 'interface_la ... (77 characters truncated) ... 0HooZcbSw==', 'email': 'changqinglei@wits.com', 'name': 'leicq', 'avatar': None, 'last_login_at': None, 'initialized_at': None, 'last_login_ip': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'password': 'MGI2MTE0NTEyOWNlODQ2NmY0OWExZWZhMWM3YWEwY2M4YjE0MzBiZjc1YzE2ZGMzMGRiMjU3YjNhZjQ4YWYxZA==', 'interface_la ... (77 characters truncated) ... 0HooZcbSw==', 'email': 'changqinglei@wits.com', 'name': 'leicq', 'avatar': None, 'last_login_at': None, 'initialized_at': None, 'last_login_ip': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 13:46:16,241.241 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:46:16] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 13:48:50,429.429 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:48:50] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:48:50,435.435 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:48:50] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:48:50,440.440 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:48:50] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:49:06,479.479 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:06] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 13:49:16,396.396 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:16] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 13:49:19,672.672 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:19] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 13:49:19,676.676 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:19] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:49:19,680.680 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:19] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:49:19,690.690 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:19] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:49:19,699.699 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:19] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 13:49:19,708.708 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:49:19] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 13:50:00,673.673 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:50:00] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:50:00,678.678 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:50:00] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:50:00,684.684 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:50:00] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:50:34,116.116 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:50:34] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 13:51:15,993.993 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:15] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 13:51:22,903.903 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:22] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 13:51:22,907.907 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:22] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:51:22,911.911 INFO [Thread-22 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:22] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:51:30,041.041 INFO [Thread-23 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:30] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:51:30,051.051 INFO [Thread-24 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:30] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 13:51:30,059.059 INFO [Thread-25 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:51:30] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 13:53:10,063.063 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 13:53:10,064.064 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 13:53:29,335.335 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:29] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:53:29,339.339 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:29] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:53:29,384.384 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:29] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:53:29,638.638 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:29] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 13:53:29,660.660 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:29] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 13:53:29,665.665 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:29] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:53:30,244.244 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:30] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:53:30,263.263 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:30] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:53:30,282.282 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:30] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 13:53:30,288.288 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:53:30] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 13:55:23,733.733 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:55:23] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 13:55:35,914.914 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:55:35] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 13:55:38,607.607 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:55:38] "[31m[1mPOST /console/api/setup HTTP/1.1[0m" 403 -
2024-08-06 13:55:39,012.012 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:55:39] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:55:39,017.017 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:55:39] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:56:13,847.847 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:56:13] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 13:56:18,960.960 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:56:18] "[31m[1mPOST /console/api/login HTTP/1.1[0m" 401 -
2024-08-06 13:57:39,388.388 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:57:39] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 13:58:42,224.224 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 13:58:42,225.225 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 13:58:51,117.117 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 13:58:51,122.122 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 13:58:51,266.266 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 13:58:51,546.546 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 13:58:51,566.566 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 13:58:51,570.570 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:58:51,574.574 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:58:51] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 13:59:12,427.427 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:59:12] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 13:59:27,026.026 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:59:27] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 13:59:35,063.063 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 13:59:35] "[31m[1mPOST /console/api/login HTTP/1.1[0m" 401 -
2024-08-06 14:00:05,174.174 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 14:00:05,178.178 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 14:00:05,185.185 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 14:00:05,193.193 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 14:00:05,211.211 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 14:00:05,229.229 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:00:05,233.233 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:05] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:00:32,208.208 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:32] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 14:00:40,659.659 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:00:40] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 14:01:49,376.376 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:01:49] "[31m[1mPOST /console/api/login HTTP/1.1[0m" 401 -
2024-08-06 14:02:49,336.336 INFO [Thread-22 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:02:49] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 14:02:53,167.167 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:02:53] "[31m[1mPOST /console/api/login HTTP/1.1[0m" 401 -
2024-08-06 14:03:04,094.094 INFO [Thread-24 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:04] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:03:04,097.097 INFO [Thread-23 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:04] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:03:05,729.729 INFO [Thread-26 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:05] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 14:03:11,048.048 INFO [Thread-25 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:11] "[31m[1mPOST /console/api/login HTTP/1.1[0m" 401 -
2024-08-06 14:03:49,481.481 INFO [Thread-28 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 14:03:49,489.489 INFO [Thread-29 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 14:03:49,493.493 INFO [Thread-30 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 14:03:49,506.506 INFO [Thread-31 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 14:03:49,524.524 INFO [Thread-32 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 14:03:49,716.716 INFO [Thread-34 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:03:49,740.740 INFO [Thread-33 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:03:49,897.897 INFO [Thread-35 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:03:49] "GET /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:04:02,381.381 INFO [Thread-27 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:04:02] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 14:04:13,756.756 INFO [Thread-37 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:04:13] "OPTIONS /console/api/login HTTP/1.1" 200 -
2024-08-06 14:04:17,105.105 INFO [Thread-36 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:04:17] "[31m[1mPOST /console/api/login HTTP/1.1[0m" 401 -
2024-08-06 14:22:59,954.954 INFO [MainThread] [_internal.py:97] - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.50:5001
2024-08-06 14:22:59,955.955 INFO [MainThread] [_internal.py:97] - [33mPress CTRL+C to quit[0m
2024-08-06 14:23:08,838.838 INFO [Thread-2 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:08] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 14:23:08,843.843 INFO [Thread-3 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:08] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 14:23:08,888.888 INFO [Thread-4 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:08] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 14:23:09,086.086 INFO [Thread-5 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:09] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 14:23:09,110.110 INFO [Thread-6 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:09] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 14:23:09,126.126 INFO [Thread-8 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:09] "OPTIONS /console/api/system-features HTTP/1.1" 200 -
2024-08-06 14:23:10,272.272 INFO [Thread-9 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:10] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:23:10,290.290 INFO [Thread-7 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:10] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:23:10,311.311 INFO [Thread-11 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:10] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 14:23:10,315.315 INFO [Thread-10 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:10] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 14:23:13,030.030 INFO [Thread-1 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:13] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 14:23:22,518.518 INFO [Thread-13 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:22] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:23:22,545.545 ERROR [Thread-12 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'NjdjMWJmZmRlZmI3MDFmNjE3M2FlOTRiNWI5MTczZTQwZWQxZGJhYWMxYjcwYjNiMjc3NjNkYTNh ... (77 characters truncated) ... alt': 'dVN7ouafSv3teP+66HGFvQ==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'NjdjMWJmZmRlZmI3MDFmNjE3M2FlOTRiNWI5MTczZTQwZWQxZGJhYWMxYjcwYjNiMjc3NjNkYTNh ... (77 characters truncated) ... alt': 'dVN7ouafSv3teP+66HGFvQ==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 14:23:22,618.618 INFO [Thread-12 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:23:22] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 14:24:43,648.648 INFO [Thread-15 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:24:43] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:24:43,672.672 ERROR [Thread-14 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'ODQ2MTE0OTcwZjBkZmJkZDQ2ZmUwNDlmMjRlZGZjMTk2MzZiNzNkMDA4YjNmZmEwOTk3MWJjY2Vi ... (77 characters truncated) ... alt': '2yNJ0OxxACDqqXqUkn1xEQ==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'ODQ2MTE0OTcwZjBkZmJkZDQ2ZmUwNDlmMjRlZGZjMTk2MzZiNzNkMDA4YjNmZmEwOTk3MWJjY2Vi ... (77 characters truncated) ... alt': '2yNJ0OxxACDqqXqUkn1xEQ==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 14:24:43,675.675 INFO [Thread-14 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:24:43] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 14:24:44,493.493 ERROR [Thread-16 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'NjM3ZmMzOTA5MTcyZjkxYzYzYzBlMjdlMzBjMWFmMGIwZDYwMGI0NWM0ZDI4MGI5NjJiYTAyMDkx ... (77 characters truncated) ... alt': 'Y+xZajhBwWHLjeIqrkANHQ==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'NjM3ZmMzOTA5MTcyZjkxYzYzYzBlMjdlMzBjMWFmMGIwZDYwMGI0NWM0ZDI4MGI5NjJiYTAyMDkx ... (77 characters truncated) ... alt': 'Y+xZajhBwWHLjeIqrkANHQ==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 14:24:44,496.496 INFO [Thread-16 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:24:44] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 14:25:58,574.574 INFO [Thread-18 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:58] "OPTIONS /console/api/apps?page=1&limit=30&name= HTTP/1.1" 200 -
2024-08-06 14:25:58,579.579 INFO [Thread-19 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:58] "OPTIONS /console/api/workspaces/current HTTP/1.1" 200 -
2024-08-06 14:25:58,586.586 INFO [Thread-20 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:58] "OPTIONS /console/api/account/profile HTTP/1.1" 200 -
2024-08-06 14:25:58,594.594 INFO [Thread-21 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:58] "[31m[1mGET /console/api/workspaces/current HTTP/1.1[0m" 401 -
2024-08-06 14:25:58,613.613 INFO [Thread-22 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:58] "[31m[1mGET /console/api/account/profile HTTP/1.1[0m" 401 -
2024-08-06 14:25:59,204.204 INFO [Thread-24 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:59] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:25:59,209.209 INFO [Thread-23 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:59] "GET /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:25:59,249.249 INFO [Thread-26 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:59] "OPTIONS /console/api/init HTTP/1.1" 200 -
2024-08-06 14:25:59,255.255 INFO [Thread-25 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:25:59] "GET /console/api/init HTTP/1.1" 200 -
2024-08-06 14:26:01,640.640 INFO [Thread-17 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:26:01] "[31m[1mGET /console/api/apps?page=1&limit=30&name= HTTP/1.1[0m" 401 -
2024-08-06 14:26:10,392.392 INFO [Thread-28 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:26:10] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:26:10,411.411 ERROR [Thread-27 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'MGMyMzMxOWRhYjU3MTUwNTRlOWE0MDA0MGFiYzEwNmM2MzFiYTFkNDlmYzFmYmI3MjQxZThhYjE4 ... (77 characters truncated) ... alt': '9vP1v069ngqgDzpdBceu/Q==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'MGMyMzMxOWRhYjU3MTUwNTRlOWE0MDA0MGFiYzEwNmM2MzFiYTFkNDlmYzFmYmI3MjQxZThhYjE4 ... (77 characters truncated) ... alt': '9vP1v069ngqgDzpdBceu/Q==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 14:26:10,415.415 INFO [Thread-27 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:26:10] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 14:26:11,888.888 ERROR [Thread-29 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'ZTkyZTE0YzcwOGQxY2ZjNmNmMzEyNGJiNDllMTEzOWE1OTk0OGUwZDEzYjhkYjhiNzc1MzEzOTZj ... (77 characters truncated) ... alt': 'QBtENAK4K88gU/46c36Pfw==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'ZTkyZTE0YzcwOGQxY2ZjNmNmMzEyNGJiNDllMTEzOWE1OTk0OGUwZDEzYjhkYjhiNzc1MzEzOTZj ... (77 characters truncated) ... alt': 'QBtENAK4K88gU/46c36Pfw==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 14:26:11,891.891 INFO [Thread-29 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:26:11] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
2024-08-06 14:26:50,504.504 INFO [Thread-31 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:26:50] "OPTIONS /console/api/setup HTTP/1.1" 200 -
2024-08-06 14:28:41,185.185 ERROR [Thread-30 (process_request_thread)] [app.py:838] - Exception on /console/api/setup [POST]
Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
AttributeError: 'str' object has no attribute 'hex'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/leicq/github/dify/api/services/account_service.py", line 514, in setup
    account = AccountService.create_account(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 161, in create_account
    db.session.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1821, in _execute_context
    self._handle_dbapi_exception(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1815, in _execute_context
    context = constructor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1457, in _init_compiled
    l_param: List[Any] = [
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 1459, in <listcomp>
    flattened_processors[key](compiled_params[key])
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/type_api.py", line 2036, in process
    return fixed_impl_processor(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/sql/sqltypes.py", line 3608, in process
    value = value.hex
sqlalchemy.exc.StatementError: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'ODhiZTcxZWIzMjI0ZDMyOGJhMGQ3NDE3MzYyOGYwOWNiYmE3Njg2MWQ5YTQ3YzgyNTBhMGQ0NGMz ... (77 characters truncated) ... alt': '1Kx5OU2q+KaQk4UeT2CB+Q==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 489, in wrapper
    resp = resource(*args, **kwargs)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask/views.py", line 110, in view
    return current_app.ensure_sync(self.dispatch_request)(**kwargs)  # type: ignore[no-any-return]
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/flask_restful/__init__.py", line 604, in dispatch_request
    resp = meth(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/wraps.py", line 44, in decorated
    return view(*args, **kwargs)
  File "/Users/leicq/github/dify/api/controllers/console/setup.py", line 55, in post
    RegisterService.setup(
  File "/Users/leicq/github/dify/api/services/account_service.py", line 532, in setup
    db.session.query(DifySetup).delete()
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 3161, in delete
    result: CursorResult[Any] = self.session.execute(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2095, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
  File "<string>", line 2, in _connection_for_bind
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/leicq/anaconda3/envs/dify/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (builtins.AttributeError) 'str' object has no attribute 'hex'
[SQL: INSERT INTO accounts (id, name, email, password, password_salt, avatar, interface_language, interface_theme, timezone, last_login_at, last_login_ip, initialized_at) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: [{'timezone': 'America/New_York', 'interface_theme': 'light', 'password': 'ODhiZTcxZWIzMjI0ZDMyOGJhMGQ3NDE3MzYyOGYwOWNiYmE3Njg2MWQ5YTQ3YzgyNTBhMGQ0NGMz ... (77 characters truncated) ... alt': '1Kx5OU2q+KaQk4UeT2CB+Q==', 'interface_language': 'en-US', 'initialized_at': None, 'last_login_ip': None, 'avatar': None, 'last_login_at': None}]] (Background on this error at: https://sqlalche.me/e/20/7s2a)
2024-08-06 14:28:41,194.194 INFO [Thread-30 (process_request_thread)] [_internal.py:97] - 127.0.0.1 - - [06/Aug/2024 14:28:41] "[35m[1mPOST /console/api/setup HTTP/1.1[0m" 500 -
